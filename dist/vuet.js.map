{"version":3,"file":"vuet.js","sources":["../src/debug.js","../src/rules/life.js","../src/rules/need.js","../src/utils.js","../src/rules/once.js","../src/rules/index.js","../src/vuet-static.js","../src/vuet.js","../src/index.js"],"sourcesContent":["\nexport default {\n  error (msg) {\n    throw new Error(`[vuet] ${msg}`)\n  },\n  warn (msg) {\n    if (process.env.NODE_ENV !== 'production') {\n      typeof console !== 'undefined' && console.warn(`[vuet] ${msg}`)\n    }\n  },\n  assertModule (vuet, name) {\n    if (name in vuet.modules) {\n      return\n    }\n    this.error(`The '${name}' module does not exist`)\n  }\n}\n","import debug from '../debug'\n\nexport default {\n  rule ({ path }) {\n    return {\n      beforeCreate () {\n        debug.assertModule(this.$vuet, path)\n        this.$vuet.getModule(path).fetch()\n      },\n      destroyed () {\n        this.$vuet.getModule(path).reset()\n      }\n    }\n  }\n}\n","import debug from '../debug'\n\nexport default {\n  rule ({ path }) {\n    return {\n      beforeCreate () {\n        debug.assertModule(this.$vuet, path)\n        this.$vuet.getModule(path).fetch()\n      }\n    }\n  }\n}\n","const utils = {\n  isObject (obj) {\n    return !!obj && Object.prototype.toString.call(obj) === '[object Object]'\n  },\n  getArgMerge () {\n    let opt = {}\n    const args = arguments\n    if (typeof args[0] === 'string') {\n      opt[args[0]] = args.length > 1 ? args[1] : args[0]\n    } else if (args[0] && utils.isObject(args[0])) {\n      opt = args[0]\n    }\n    return opt\n  },\n  isPromise (obj) {\n    return !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function'\n  }\n}\n\nexport default utils\n","import debug from '../debug'\nimport utils from '../utils'\n\nexport default {\n  init (vuet) {\n    vuet.__once__ = {}\n  },\n  rule ({ path }) {\n    return {\n      beforeCreate () {\n        debug.assertModule(this.$vuet, path)\n        if (this.$vuet.__once__[path]) return\n        const back = this.$vuet.getModule(path).fetch()\n        if (utils.isPromise(back)) {\n          return back.then(res => {\n            this.$vuet.__once__[path] = true\n          })\n        }\n        this.$vuet.__once__[path] = true\n      }\n    }\n  }\n}\n","import life from './life'\nimport need from './need'\nimport once from './once'\n\nexport default function install (Vuet) {\n  Vuet\n    .rule('life', life)\n    .rule('need', need)\n    .rule('once', once)\n}\n","import debug from './debug'\nimport utils from './utils'\n\nexport default function (Vuet) {\n  Object.assign(Vuet, {\n    installed: false,\n    options: {\n      rules: {}\n    },\n    install (Vue) {\n      if (this.installed) return this\n      this.installed = true\n      this.Vue = Vue\n      Object.defineProperty(Vue.prototype, '$vuet', {\n        get () { return this.$root._vuet }\n      })\n      Vue.mixin({\n        beforeCreate () {\n          if (typeof this.$options.vuet !== 'undefined') {\n            this._vuet = this.$options.vuet\n            // this._vuet._init(this)\n          }\n        },\n        destroyed () {\n          if (typeof this.$options.vuet !== 'undefined') {\n            this._vuet = this.$options.vuet\n            this._vuet.destroy(this)\n          }\n        }\n      })\n      return this\n    },\n    mapModules (opts) {\n      const mixins = Object.keys(opts).map(alias => {\n        const path = opts[alias]\n        return {\n          computed: {\n            [alias]: {\n              get () {\n                debug.assertModule(this.$vuet, path)\n                return this.$vuet.modules[path].state\n              },\n              set (val) {\n                debug.assertModule(this.$vuet, path)\n                this.$vuet.modules[path].state = val\n              }\n            },\n            [`$${alias}`]: {\n              get () {\n                debug.assertModule(this.$vuet, path)\n                return this.$vuet.modules[path]\n              },\n              set () { }\n            }\n          }\n        }\n      })\n      return {\n        mixins\n      }\n    },\n    mapRules () {\n      const opts = utils.getArgMerge.apply(null, arguments)\n      const vueRules = []\n      const addRule = (ruleName, any) => {\n        const rules = Vuet.options.rules[ruleName]\n        if (typeof any === 'string') {\n          vueRules.push(rules.rule({ path: any }))\n        } else {\n          vueRules.push(rules.rule(any))\n        }\n      }\n      Object.keys(opts).forEach(ruleName => {\n        const any = opts[ruleName]\n        if (Array.isArray(any)) {\n          return any.forEach(item => {\n            addRule(ruleName, item)\n          })\n        }\n        addRule(ruleName, any)\n      })\n      return {\n        mixins: vueRules\n      }\n    },\n    rule () {\n      Vuet.options.rules[arguments[0]] = arguments[1]\n      return this\n    },\n    callRuleHook (hook, vuet) {\n      Object.keys(Vuet.options.rules).forEach(k => {\n        if (typeof Vuet.options.rules[k][hook] === 'function') {\n          Vuet.options.rules[k][hook](vuet)\n        }\n      })\n    }\n  })\n}\n","import utils from './utils'\n\nexport default class Vuet {\n  constructor (opts) {\n    this.modules = {}\n    this.store = {}\n    this.options = {\n      pathJoin: '/',\n      modules: {}\n    }\n    this.app = new Vuet.Vue({\n      data: {\n        modules: this.store\n      }\n    })\n    Object.assign(this.options, opts)\n    const initModule = (paths, modules) => {\n      Object.keys(modules).forEach(path => {\n        const newNames = [...paths, path]\n        const newName = newNames.join(this.options.pathJoin)\n        if (!utils.isObject(modules[path])) return\n        if (typeof modules[path].data === 'function') {\n          this.register(newName, modules[path])\n        }\n        Object.keys(modules[path]).forEach(chlidName => {\n          if (utils.isObject(modules[path][chlidName])) {\n            initModule(newNames, modules[path])\n          }\n        })\n      })\n    }\n    initModule([], this.options.modules)\n    Vuet.callRuleHook('init', this)\n  }\n  _init () {\n  }\n  register (path, opts) {\n    const vuet = this\n    Vuet.Vue.set(vuet.store, path, opts.data())\n    Object.defineProperty(opts, 'state', {\n      get () {\n        return vuet.store[path]\n      },\n      set (val) {\n        vuet.store[path] = val\n      }\n    })\n    Object.assign(opts, {\n      reset () {\n        this.state = this.data()\n      }\n    })\n    Object.keys(opts).forEach(k => {\n      if (typeof opts[k] === 'function') {\n        const native = opts[k]\n        opts[k] = function proxy () {\n          return native.apply(vuet.modules[path], arguments)\n        }\n      }\n    })\n    if (utils.isObject(opts.state)) {\n      Object.keys(opts.state).forEach(k => {\n        Object.defineProperty(opts, k, {\n          get () {\n            return vuet.store[path][k]\n          },\n          set (val) {\n            vuet.store[path][k] = val\n          }\n        })\n      })\n    }\n    vuet.modules[path] = opts\n    return this\n  }\n  getModule (path) {\n    return this.modules[path]\n  }\n  getState (path) {\n    return this.modules[path].state\n  }\n  destroy () {\n    this.vm.$destroy()\n  }\n}\n","import rules from './rules/index'\nimport VuetStatic from './vuet-static'\nimport Vuet from './vuet'\n\nVuetStatic(Vuet)\nrules(Vuet)\n\nexport const mapRules = Vuet.mapRules.bind(Vuet)\nexport const mapModules = Vuet.mapModules.bind(Vuet)\n\nexport default Vuet\n"],"names":["msg","Error","process","console","warn","vuet","name","modules","error","path","assertModule","$vuet","getModule","fetch","reset","utils","obj","Object","prototype","toString","call","opt","args","arguments","length","isObject","then","__once__","back","isPromise","install","Vuet","rule","life","need","once","assign","Vue","installed","defineProperty","$root","_vuet","mixin","$options","destroy","opts","mixins","keys","map","alias","state","val","getArgMerge","apply","vueRules","addRule","ruleName","any","rules","options","push","forEach","Array","isArray","item","hook","k","store","app","initModule","paths","newNames","newName","join","pathJoin","data","register","chlidName","callRuleHook","set","native","proxy","vm","$destroy","VuetStatic","mapRules","bind","mapModules"],"mappings":"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"}